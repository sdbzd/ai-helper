一、架构设计Prompt
1.1 系统设计Prompt

设计一个多用户移动应用代理系统，具体要求：
1. 主应用(App1)管理多个用户，每个用户可配置多个目标应用(App2)的登录凭证
2. App2没有提供API接口，必须通过UI自动化方式模拟用户登录操作
3. 系统需要支持多种应用类型：Web应用、原生Android应用
4. 实现安全存储和加密机制保护用户凭证
5. 支持可配置的登录流程脚本，能够处理验证码、多因素认证等复杂场景

技术约束：
- 使用Rust和Tauri框架开发移动应用
- 需要跨平台支持(Android)
- 自动化引擎需要在沙箱环境中运行以确保安全
- 用户界面需要支持登录脚本的录制、编辑和测试

请提供：
1. 完整的系统架构图和各模块职责
2. 关键模块的技术选型建议
3. 数据流和安全设计
4. 扩展性考虑和未来演进路径
二、模块级Prompt
2.1 UI自动化引擎Prompt

设计一个跨平台的UI自动化引擎，要求：
输入：登录配置脚本(JSON/YAML格式)，包含元素选择器、操作序列、等待条件
输出：登录成功状态、会话令牌、错误信息

功能要求：
1. 支持Web应用(通过浏览器控制)
2. 支持原生移动应用(通过可访问性API)
3. 支持条件判断和错误恢复机制
4. 能够处理验证码(OCR识别、人工介入、第三方服务)
5. 模拟人类操作模式避免反自动化检测

技术约束：
- 使用Rust语言实现核心引擎
- Web控制使用Playwright或类似技术
- 原生控制使用各平台的可访问性框架
- 需要在隔离的沙箱进程中运行

请设计：
1. 引擎架构和组件划分
2. 统一的操作抽象接口
3. 插件化扩展机制
4. 性能优化和资源管理策略
2.2 脚本管理器Prompt
text
设计一个登录脚本管理系统，要求：
1. 支持脚本录制：记录用户在目标应用上的操作并生成脚本
2. 脚本编辑：可视化编辑操作步骤、元素选择器、等待时间
3. 脚本测试：在安全环境中测试脚本有效性
4. 版本管理：记录脚本变更历史，支持回滚
5. 社区共享：用户可分享和导入他人创建的脚本

技术规格：
- 脚本格式：YAML或JSON，包含版本信息
- 元素定位：支持CSS选择器、XPath、图像识别、坐标定位
- 操作类型：点击、输入、滑动、等待、条件判断、循环
- 变量系统：支持从凭证库动态获取值

请设计：
1. 脚本数据结构和格式规范
2. 录制引擎的工作原理
3. 脚本验证和测试框架
4. 版本控制系统设计
2.3 安全存储Prompt
text
设计一个移动端安全存储系统，要求：
1. 加密存储多组用户凭证(用户名、密码、令牌等)
2. 支持生物识别解锁(指纹、面部识别)
3. 实现密钥的安全生成和存储
4. 提供凭证的安全检索和自动填充
5. 支持凭证的备份和恢复

安全要求：
- 使用硬件安全模块(如Android KeyStore)
- 实施内存安全措施(敏感数据零化)
- 防止侧信道攻击
- 支持密钥轮换和撤销

技术约束：
- 使用Rust实现加密逻辑
- 跨平台兼容Android
- 集成Tauri的安全API

请设计：
1. 密钥管理方案
2. 加密存储数据结构
3. 生物识别集成方案
4. 备份恢复机制
三、功能级Prompt
3.1 脚本录制功能Prompt

实现一个脚本录制器，功能要求：
1. 用户开启录制模式后，系统监控用户与目标应用的交互
2. 自动识别UI元素并生成选择器
3. 记录操作序列(点击、输入、滑动等)
4. 智能识别登录流程的关键节点(用户名输入、密码输入、登录按钮)
5. 自动生成包含等待条件和错误处理的脚本

技术实现：
- 在Tauri应用中嵌入WebView或使用系统浏览器
- 通过注入JavaScript监控DOM变化
- 使用启发式算法识别表单字段类型
- 生成多套备选选择器提高脚本鲁棒性

输出：
结构化脚本文件，包含：
- 应用元数据(名称、版本、URL)
- 元素定位器列表
- 操作步骤序列
- 验证条件(登录成功判断)
- 错误处理逻辑
3.2 验证码处理Prompt

设计验证码处理系统，要求支持：
1. OCR识别：常见验证码的自动识别
2. 人工介入：无法识别时通知用户手动输入
3. 第三方服务：集成验证码识别API
4. 智能跳过：识别验证码类型，选择最优策略

具体功能：
- 图像预处理：降噪、二值化、分割
- 机器学习模型：训练识别特定网站的验证码
- 人工任务队列：用户可在手机上快速输入验证码
- 成本控制：平衡自动化识别和人工介入

技术方案：
- 使用Tesseract或类似OCR引擎
- 集成Rust的机器学习库
- 设计异步任务处理管道
- 实现验证码缓存和黑名单机制
3.3 多用户管理Prompt

设计多用户管理系统，要求：
1. 主账户系统：App1自身的用户身份验证
2. 子账户关联：每个主账户可管理多个App2账户
3. 权限控制：不同用户对App2账户的访问权限
4. 使用统计：记录各账户的登录历史和使用情况
5. 快速切换：在不同App2账户间快速切换

功能设计：
- 用户角色：管理员、普通用户、只读用户
- 组织架构：支持分组管理App2账户
- 登录委派：允许临时授权他人使用账户
- 审计日志：记录所有敏感操作

技术实现：
- 使用SQLite存储用户数据
- JWT令牌管理会话
- 实现RBAC权限模型
- 设计简洁的用户界面
四、集成Prompt
4.1 Tauri集成Prompt
text
在Tauri框架中集成UI自动化系统，要求：
1. 主进程：负责用户界面和业务逻辑
2. 侧载进程：在独立进程中运行自动化引擎
3. IPC通信：安全地在进程间传递凭证和指令
4. 原生API：调用平台特定的安全存储和生物识别

架构设计：
- Tauri窗口：显示用户界面和脚本编辑器
- 自动化服务进程：运行Playwright/原生自动化
- 安全存储插件：集成平台密钥管理
- 系统托盘：后台运行和状态通知

技术挑战：
- Rust异步编程和线程安全
- 跨进程通信的安全实现
- 资源释放和内存管理
- 错误处理和恢复机制
4.2 跨平台支持Prompt
text
实现跨Android的UI自动化系统，要求：
1. Web应用：通过嵌入式浏览器控制
2. Android原生应用：通过无障碍服务(accessibility service)
3. 混合应用：智能识别应用类型并选择合适的驱动

技术方案：
- 抽象层：统一的操作接口
- 平台适配器：各平台的实现
- 自动检测：识别目标应用的类型
- 回退机制：当一种方法失败时尝试其他方法

设计考虑：
- 性能影响：最小化自动化对系统的影响
- 权限管理：处理不同平台的权限要求
- 用户体验：保持应用响应性
- 测试覆盖：确保各平台的兼容性

五、项目拆分与落地建议
1. 分模块成多项目/Crate：
   - automation-engine：跨平台驱动抽象与验证码管线
   - script-manager：脚本数据结构、录制/版本/校验
   - secure-vault：密钥管理与凭证库封装
   - integration-ipc：Tauri/IPC 请求响应与进程隔离封装
   - app-shell：主 UI 与配置聚合，依赖以上库
2. 最小可行实现(MVP)顺序：
   - 完成脚本格式 + 录制存储接口（纯内存/文件）
   - 自动化引擎跑通模拟执行路径（Web/Android）
   - 凭证加解密流程（Keystore/Keychain 接口 stub）
   - IPC 调用链：UI -> IPC -> 自动化执行 -> 返回结果
3. 构建与交付：
   - Cargo workspace 管理多 Crate，按平台启用 feature flag
   - 每个 Crate 提供示例/测试用例，确保独立演进
   - 通过 GitHub Actions 分平台检查（lint/test/build）